<!DOCTYPE html>
<html lang="zh-cn">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
				<title>Public Round #3 题解 - Blog - p_b_p_b' blog</title>
		
		<script type="text/javascript">uojHome = '//pjudge.ac'</script>
	
		<!-- jQuery (necessary for Bootstrap\'s JavaScript plugins) -->
		<script src="//pjudge.ac/js/jquery.min.js"></script>

		<!-- jQuery autosize -->
		<script src="//pjudge.ac/js/jquery.autosize.min.js"></script>		<script type="text/javascript">
			$(document).ready(function() {
				$('textarea').autosize();
			});
		</script>
		
		<!-- jQuery cookie -->
		<script src="//pjudge.ac/js/jquery.cookie.min.js"></script>		
		<!-- jQuery modal -->
		<script src="//pjudge.ac/js/jquery.modal.js"></script>		
		
				<!-- Bootstrap core CSS -->
		<link type="text/css" rel="stylesheet" href="//pjudge.ac/css/bootstrap.min.css?v=2019.5.31" />		<!-- Bootstrap Glyphicons CSS-->
		<link type="text/css" rel="stylesheet" href="//pjudge.ac/css/bootstrap-glyphicons.min.css?v=2019.5.31" />
		<!-- Custom styles for this template -->
		<link type="text/css" rel="stylesheet" href="//pjudge.ac/css/uoj-theme.css?v=3.0.1" />		
		<!-- Include all compiled plugins (below), or include individual files as needed -->
		<script src="//pjudge.ac/js/popper.min.js?v=2019.5.31"></script>		<script src="//pjudge.ac/js/bootstrap.min.js?v=2019.5.31"></script>		
		<!-- Color converter -->
		<script src="//pjudge.ac/js/color-converter.min.js"></script>		
		<!-- uoj -->
		<script src="//pjudge.ac/js/uoj.js?v=2022.04.13c"></script>		
		<!-- readmore -->
		<script src="//pjudge.ac/js/readmore/readmore.min.js"></script>		
		<!-- LAB -->
		<script src="//pjudge.ac/js/LAB.min.js"></script>
		<link type="text/css" rel="stylesheet" href="//pjudge.ac/css/flag-icon-css/css/flag-icon.css" />				
		
<link type="text/css" rel="stylesheet" href="//pjudge.ac/css/font-awesome/5.13.0/all.min.css" />
				
				
				
				<!-- MathJax -->
		<script type="text/x-mathjax-config">
			MathJax.Hub.Config({
				showProcessingMessages: false,
				tex2jax: {
					inlineMath: [["$", "$"], ["\\\\(", "\\\\)"]],
					processEscapes:true
				},
				menuSettings: {
					zoom: "Hover"
    			}
			});
		</script>
		<script src="//cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js?config=TeX-AMS_HTML"></script>
				
				
		
				
				
				
				
				<!-- shjs -->
		<link type="text/css" rel="stylesheet" href="//pjudge.ac/css/sh_typical.min.css" />		<script src="//pjudge.ac/js/sh_main.min.js"></script>		<script type="text/javascript">$(document).ready(function(){sh_highlightDocument()})</script>
				
		
		<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
		<!--[if lt IE 9]>
			<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
			<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->
		
		<script type="text/javascript">
		before_window_unload_message = null;
		$(window).on('beforeunload', function() {
			if (before_window_unload_message !== null) {
			    return before_window_unload_message;
			}
		});
		</script>
		
			</head>
	<body role="document">
				<div class="container" role="main">
								<div>
				<ul class="nav nav-pills float-right" role="tablist">
									<li class="nav-item dropdown">
						<a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown">
<span class="uoj-username" data-first-letter=0 data-user-color="rgb(55, 205, 155)" data-permission-symbol=0 data-rating="1800" data-usergroup="U" data-color = "" data-nickname = "wangjunrui">wangjunrui</span>
																					 						</a>
						<ul class="dropdown-menu" role="menu">
							<li role="presentation"><a class="dropdown-item" href="//pjudge.ac/user/profile/wangjunrui"><span class="glyphicon glyphicon-info-sign"></span>个人信息</a></li>
							<li role="presentation"><a class="dropdown-item" href="//pjudge.ac/user/msg"><span class="glyphicon glyphicon-envelope"></span>私信&nbsp;&nbsp;</a></li>
							<li role="presentation"><a class="dropdown-item" href="//pjudge.ac/user/system-msg"><span class="glyphicon glyphicon-flag"></span>系统消息&nbsp;&nbsp;</a></li>
													</ul>
					</li>
					<li class="nav-item" role="presentation"><a class="nav-link" href="//pjudge.ac/logout?_token=rlXpJoLplrYJBj8Ds4JK9VGt2X727lwLHPphqG7fQDJXpQrfmLEK5rvmzLRB">登出</a></li>
								</ul>
				<h1 class="d-none d-sm-block">p_b_p_b' blog</h1>
				<h1 class="d-block d-sm-none">Blog</h1>
			</div>
			
			<div class="navbar navbar-light navbar-expand-md bg-light mb-4" role="navigation">
	<a class="navbar-brand" href="https://pjudge.ac/blog/p-b-p-b">p_b_p_b</a>
	<button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">导航</span>
		<span class="navbar-toggler-icon"></span>
	</button>
	<div class="navbar-collapse collapse">
		<ul class="nav navbar-nav">
		<li class="nav-item"><a class="nav-link" href="https://pjudge.ac/blog/p-b-p-b/archive"><span class="glyphicon glyphicon-inbox"></span> 日志</a></li>
		<li class="nav-item"><a class="nav-link" href="https://pjudge.ac/blog/p-b-p-b/aboutme"><span class="glyphicon glyphicon-user"></span> 关于我</a></li>
			<li class="nav-item"><a class="nav-link" href="//pjudge.ac"><span class="glyphicon glyphicon-link"></span> pjudge</a></li>
		</ul>
	</div><!--/.nav-collapse -->
</div>
<script type="text/javascript">
	var uojBlogUrl = 'https://pjudge.ac/blog/p-b-p-b';
	var zan_link = uojBlogUrl;
</script>
						
			<div class="uoj-content">
<h2><a class="header-a" href="https://pjudge.ac/blog/p-b-p-b/post/550">Public Round #3 题解</a></h2>
<div>2022-04-14 13:10:01 <strong>By</strong> <span class="uoj-username" data-first-letter=0 data-user-color="rgb(255, 51, 204)" data-permission-symbol=0 data-rating="10000" data-usergroup="U" data-badge="" data-color = "" data-nickname = "p_b_p_b">p_b_p_b</span> </div>
<div class="card mb-4">
	<div class="card-body">
				<article><ul><li>搬题人：<ul><li>A：<span class="uoj-username" data-admin="1" data-rating="1800">hehezhou</span></li>
<li>B, C：<span class="uoj-username" data-admin="1" data-rating="1800">p_b_p_b</span></li>
</ul></li>
<li>组题人：<span class="uoj-username" data-admin="1" data-rating="1800">FSYo</span>, <span class="uoj-username" data-admin="1" data-rating="1800">p_b_p_b</span></li>
<li>验题人：<span class="uoj-username" data-admin="1" data-rating="1800">chenkuowen01</span>, <span class="uoj-username" data-admin="1" data-rating="1800">srf</span></li>
<li>题解：<span class="uoj-username" data-admin="1" data-rating="1800">chenkuowen01</span>, <span class="uoj-username" data-admin="1" data-rating="1800">hehezhou</span>, <span class="uoj-username" data-admin="1" data-rating="1800">p_b_p_b</span></li>
</ul><h3>最小生成树</h3>
<p>题目来源：</p>
<ul><li>京都大学<ruby>プログラミング<rt><b>Programming</b></rt></ruby><ruby>コンテスト<rt><b>Contest</b></rt></ruby> 2020</li>
<li>Petrozavodsk Summer 2021 Day 1: Kyoto U Contest (KUPC 2020), Problem F</li>
</ul><p>QOJ 链接：<a href="https://qoj.ac/contest/691/problem/1809">https://qoj.ac/contest/691/problem/1809</a></p>
<p>官方题解：<a href="https://qoj.ac/download.php?type=attachments&amp;id=691&amp;r=1">https://qoj.ac/download.php?type=attachments&amp;id=691&amp;r=1</a></p>
<h4>解法一</h4>
<p>  将图建出来然后使用任意最小生成树算法求解。</p>
<p>  时间复杂度 $\Theta((H\times W)^{1+\epsilon})$，可以通过前6个测试点。</p>
<h4>解法二</h4>
<p><strong>lemma 1</strong>: 一定存在一组最小生成树使得对于每个点 $P_{i,j}(i\gt 1\land j\gt 1)$ 存在和 $(i-1,j)$ 或 $(i,j-1)$ 的连边。</p>
<p><strong>proof</strong>:</p>
<p>假设该结论不成立，那么对于所有最小生成树使得每个点 $P_{i,j}(i\gt 1\land j\gt 1)$ 都不存在这样的连边。</p>
<p>取其中一个点 $P_{i,j}$。</p>
<p>若其度数为 $1$，不妨令该边为 $(P_{i,j},P_{i+1,j})$，则删去该边后 $P_{i+1,j}$ 与 $P_{i-1,j}$ 在同一个连通块内，将该边替换为 $(P_{i-1,j},P_{i,j})$ 不劣。</p>
<p>若其度数为 $2$，考虑删去这两条边的连通块情况。</p>
<ul><li>若 $P_{i+1,j},P_{i-1,j}$ 或 $P_{i,j-1},P_{i,j+1}$ 在同一连通块内，不妨令这组为 $P_{i+1,j},P_{i-1,j}$，那么替换对应边为 $(P_{i-1,j},P_{i,j})$ 不劣。</li>
<li>否则，$P_{i+1,j}$与$P_{i,j-1}$在同一连通块内且$P_{i,j+1}$与$P_{i-1,j}$在同一连通块内，将这两条边一并替换为$(P_{i-1,j},P_{i,j}),(P_{i,j-1},P_{i,j})$。</li>
</ul><p>按上述方法调整即可找出矛盾。故假设不成立。</p>
<p>证毕。</p>
<p><strong>lemma 2</strong>: 一定存在一组最小生成树 $T$ 使得对于任意 $1\le x\le H,1\le y\le W$，$T$ 关于点集 $\lbrace P_{i,j} | 1\le i\le x,1\le j\le y\rbrace$ 的导出子图为连通图。</p>
<p><strong>proof</strong>:</p>
<p>假设该结论不成立，那么对于所有最小生成树都存在对应的 $x,y$ 不符合该性质。</p>
<p>我们取一组符合 <strong>lemma 1</strong> 的最小生成树和 $(x,y)$ 字典序最小的不符合条件的矩阵。</p>
<ul><li>该导出子图不连通，所以一定存在 $i$ 使得 $P_{1,i},P_{1,i+1}$ 不连通，或 $P_{i,1},P_{i+1,1}$ 不连通，不妨只考虑后者。</li>
<li>考虑 $P_{i,1}$ 到 $P_{i+1,1}$ 在原图 $T$ 中的路径一定存在某个 $j$ 使得存在边 $(P_{i,j},P_{i+1,j})$，那么将该边替换为 $(P_{i,1},P_{i+1,1})$ 不会破坏性质且不劣。</li>
<li>重复该方法可得到一个对于任意 $1\le x'\le x,1\le y'\le y$ 符合点集 $\lbrace P_{i,j} | 1\le i\le x',1\le j\le y'\rbrace$ 的导出子图为连通图的最小生成树。</li>
</ul><p>重复该过程可发现矛盾，故假设不成立。</p>
<p>证毕。</p>
<p>根据 <strong>lemma 2</strong>，我们可以按 $i,j$ 从小到大枚举加入维护的生成树，因此答案的权值和为：
$$\displaystyle\sum_{i=1}^{H-1} (A_i+B_1)+ \displaystyle\sum_{j=1}^{W-1} (C_1+D_i)+\displaystyle\sum_{i=2}^{H-1} \displaystyle\sum_{j=2}^{W-1} \min(A_{i-1}+B_j,C_i+D_{j-1})$$</p>
<p>其中：</p>
<p>$$\min(A_{i-1}+B_j,C_i+D_{j-1})=A_{i-1}+B_j+\lbrack C_i-A_{i-1}+D_j-B_{j-1}&lt; 0 \rbrack (C_i-A_{i-1}+D_j-B_{j-1})$$</p>
<p>将 $i,j$ 分离后可用二分+前缀和优化，时间复杂度 $\Theta((H+W)\log (H+W))$，空间复杂度 $\Theta(H+W)$</p>
<p>该算法可以通过所有测试点。</p>
<h3>猜数</h3>
<p>题目来源：Petrozavodsk Winter 2022 Day 6: ICPC Camp Day 1, PKU Contest, Problem E</p>
<p>QOJ 链接：<a href="https://qoj.ac/contest/824/problem/2609">https://qoj.ac/contest/824/problem/2609</a></p>
<p>官方题解：<a href="https://qoj.ac/download.php?type=attachments&amp;id=824&amp;r=1">https://qoj.ac/download.php?type=attachments&amp;id=824&amp;r=1</a></p>
<p>在获得足够的关于 <code>seed</code> 的信息之前，返回值与真实答案不怎么相关。因此我们应当考虑先求出 <code>seed</code> 。</p>
<p>生成一次随机数可以被拆成三步：</p>
<ol><li><code>seed*=n;</code></li>
<li><code>seed%=P;</code></li>
<li><code>return seed%n;</code></li>
</ol><p>注意到，如果没有第二步，那么 <code>seed%n</code> 永远是 $0$ 。因此 <code>seed%n</code> 可以告诉我们在第二步中 <code>seed</code> 减掉了几个 <code>P</code> 。</p>
<p>由此可以获得一个暴力做法：先询问 $40$ 次 $0$ ，获得每一次的 <code>seed%n</code> 。然后在 $[0,P)$ 里枚举 <code>seed</code> ，判断结果是否符合。符合的那个 <code>seed</code> 就是真实的 <code>seed</code> 。接下来再用 $60$ 次询问来二分答案即可。</p>
<p>由于错误的 <code>seed</code> 只会期望符合前 $O(1)$ 个位置，因此这个做法的时间复杂度是 $O(P)$ 的。</p>
<p>（事实上，直接判断返回值是否正确即可，因此并不需要推导到这里就可以获得 $O(P)$ 的暴力做法。）</p>
<p>考虑如何优化。</p>
<p>倒着做，维护 $[l,r]$ 表示已知 <code>seed</code> 现在在区间 $[l,r]$ 内，每次回退一步。那么由于知道 <code>seed%P</code> 减掉了几个 <code>P</code> ，就可以知道在第二步之前的 <code>seed</code> 所在的区间。然后 <code>seed*=n</code> 反过来就可以把区间长度除掉 $n$ 。</p>
<p>由于 $n^{40}&gt;P$ ，所以回退 $40$ 步足以确定起始的 <code>seed</code> 。然后仍然二分答案即可。</p>
<h3>抽卡</h3>
<p>题目来源：Petrozavodsk Winter 2022 Day 6: ICPC Camp Day 1, PKU Contest, Problem B</p>
<p>QOJ 链接：<a href="https://qoj.ac/contest/824/problem/2606">https://qoj.ac/contest/824/problem/2606</a></p>
<p>官方题解：<a href="https://qoj.ac/download.php?type=attachments&amp;id=824&amp;r=1">https://qoj.ac/download.php?type=attachments&amp;id=824&amp;r=1</a></p>
<h4>题解一</h4>
<p>首先考虑计算一次合法抽卡的概率。</p>
<p>令 $f_{i,j}$ 表示一次 $i$ 级抽卡，合法且抽出的卡最大值<strong>不超过</strong> $j$ 的概率，那么有：</p>
<p>$$f_{i,j}=f_{i-1,j}^{b_i}-f_{i-1,i-1}^{b_i}$$</p>
<p>后一项即为减去不合法的概率。</p>
<p>我们把抽卡过程看成一棵树，因为各叶子是等价的，只考虑最左侧叶子的贡献，考虑对根到最左侧的路径进行 $\text{dp}$（另一种理解是将各级抽卡的第一次抽卡设为关键抽卡）。</p>
<p>接下来考虑倒过来 $\text{dp}$，设 $g_{i,j}$ 表示一次合法抽卡过程中，若最左侧的 $i$ 级抽卡最大值为 $j$ ，最终 $n$ 级抽卡合法的概率，那么有：</p>
<p>$$g_{i,j}=g_{i+1,j}\sum_{k=0}^j s_{i,k}+\sum_{k=j+1}s_{i,k}g_{i+1,k}$$</p>
<p>其中 $s_{i,j}=f_{i,j}^{b_{i+1}-1}-f_{i,j-1}^{b_{i+1}-1}$，即第 $i$ 层其他抽卡最大值为 $j$ 的概率。上述式子可以分两部分前缀和优化。</p>
<p>总复杂度为 $O(n^2\log B)$，瓶颈在计算快速幂。</p>
<h4>题解二</h4>
<p>显然 $m&gt;n$ 可以特判成 $m=n$ ，所以后面认为抽卡等级和卡等级的上限是相同的。另外，后面的 $a_i$ 也全都表示概率，即已经除掉了 $\sum_{i=0}^n a_i$ 。</p>
<p>使用自底向上的思考方式，把低等级抽卡逐步合并为高等级抽卡。</p>
<p>相应地，我们也在合并的过程中逐步确定每次抽出来的卡的等级。当我们在考虑所有 $k$ 级抽卡时，所有等级 $&lt;k$ 的卡已经确定了，而等级 $\ge k$ 的卡的等级则未定。</p>
<p>那么可以设
$$
f_k(x)=\sum_{s\in S_k} p(s)x^{cnt_{\ge k}(s)}
$$
 其中 $S_k$ 表示当所有等级 $\ge k$ 的卡被视为同一类时，合法的 $k$ 级抽卡的集合；$p(s)$ 表示等级 $&lt;k$ 的卡的出现概率的乘积；$cnt_{\ge k}(s)$ 表示等级 $\ge k$ 的卡的个数。</p>
<p>转移式非常简单：
$$
f_0(x)=x\\
f_k(x)=f_{k-1}^{b_k}(x+a_{k-1})-f_{k-1}^{b_k}(a_{k-1})
$$
并且容易发现 $f_n(a_n)$ 就是一个 $n$ 级抽卡合法的概率，$a_nf'_n(a_n)$ 就是 $p_n\cdot q$ 。</p>
<p>如何求出这两个点值呢？从转移式可以注意到，为了求出这两个点值，对于所有的 $f_k(x)$ ，$x$ 只可能是从 $k$ 开始的若干个 $a_i$ 之和！</p>
<p>因此，可以设 $dp1_{k,r}=f_k(\sum_{i=k}^r a_i),dp2_{k,r}=f_k'(\sum_{i=k}^r a_i)$ ，然后使用转移式转移即可。</p>
<p>接下来考虑求出所有的 $p_k\cdot q$ 。</p>
<p>受到 $a_nf'_n(a_n)$ 的启发，可以想到用第二个变量来记录等级为 $k$ 的卡的数量，然后同样用求导的方式求出 $p_k\cdot q$ 。于是可以引入二元生成函数 $g(x,y)$ ：
$$
g_0(x,y)=x\\
g_k(x,y)=\begin{cases}
g^{b_k}_{k-1}(x+y,y)-g^{b_k}_{k-1}(y,y)&amp;k=T\\
g^{b_k}_{k-1}(x+a_{k-1},y)-g^{b_k}_{k-1}(a_{k-1},y)&amp;k\ne T
\end{cases}
$$
其中 $T$ 表示现在要求 $p_T\cdot q$ 。</p>
<p>那么设 $h_k(x,y)=\frac{\partial}{\partial y}g_k(x,y)$ ，就有 $p_T\cdot q=a_T h_n(a_n,a_T)$ 。</p>
<p>容易发现 $g,h$ 也有与 $f$ 类似的性质，即 $x$ 只可能代入 $\sum_{i=k}^r a_i$ ，因此也可以用类似的 DP 求出所有点值。这样就获得了一个 $O(n^3\log b)$ 的做法。</p>
<p>为了优化，注意到我们总是有 $g_k(\sum_{i=k}^r a_i,a_T)=f_k(\sum_{i=k}^r a_i)$ ，只有 $h$ 不确定，而且在 $g$ 已知时 $h$ 的转移是线性关系。因此可以设 $dp3_{k,r}$ 表示 $h_k(\sum_{i=k}^r a_i,a_T)$ 的贡献系数，而这个贡献系数与 $T$ 无关。这样倒着把 $dp3$ 递推出来之后就可以直接得到答案了。</p>
<p>所以最终复杂度 $O(n^2\log b)$ 。</p>

</article>
			</div>
	<div class="card-footer text-right">
		<ul class="list-inline bot-buffer-no">
			<li class="list-inline-item">
						</li>
			  			  			<li class="list-inline-item"><div class="uoj-click-zan-block" data-id="550" data-type="B" data-val="0" data-cnt="6"></div></li>
		</ul>
	</div>
</div>
<h2>评论 <span class="glyphicon glyphicon-comment"></span></h2>
<div class="list-group">
	<div class="list-group-item text-muted">No comments yet</div>
</div>
<h3 class="mt-4">Comments are turned off.</h3>
			</div>
						<div class="uoj-footer">
				<div class="btn-group dropright mb-3">
					<button type="button" class="btn btn-sm btn-outline-secondary dropdown-toggle" data-toggle="dropdown">
						<span class="glyphicon glyphicon-globe"></span> 简体中文					</button>
					<div class="dropdown-menu">
						<a class="dropdown-item" href="//pjudge.ac/blog/p-b-p-b/post/550?locale=en">English</a>
						<a class="dropdown-item" href="//pjudge.ac/blog/p-b-p-b/post/550?locale=fr">Français</a>
						<a class="dropdown-item" href="//pjudge.ac/blog/p-b-p-b/post/550?locale=ru">Русский</a>
						<a class="dropdown-item" href="//pjudge.ac/blog/p-b-p-b/post/550?locale=zh-tw">繁體中文</a>
						<a class="dropdown-item" href="//pjudge.ac/blog/p-b-p-b/post/550?locale=zh-cn">简体中文</a>
					</div>
				</div>
				
				<ul class="list-inline"><li class="list-inline-item">Public Judge</li> | <li class="list-inline-item"> <a href="https://qoj.ac">QOJ 4.3.171.0.dev</a></li></ul>
								<p>服务器时间: 2022-04-14 18:41:33 | <a href="https://github.com/UniversalOJ/UOJ-System" target="_blank">开源项目</a></p>
			</div>
					</div>
		<!-- /container -->
	</body>
</html>
