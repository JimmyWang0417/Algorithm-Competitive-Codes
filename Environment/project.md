### 对之权值
直接考虑每个数对对答案的影响比较困难，但是可以发现所有的数中，最大值一定是 $\max\{t_{1,i}\}$ 或者 $\max\{t_{2,j}\}$，最小值一定是 $\min\{t_{1,i}\}$ 或者 $\min\{t_{2,j}\}$，又因为把所有数交换行对答案没有影响，所以可以考虑以下两种情况：

 - 最大值和最小值在同一行
 - 最大值和最小值不在同一行

先考虑同一行的情况。为了方便，默认 $a_i > b_i$。

先求出最大值和最小值的位置 $maxValPos, minValPos$，则最大值和最小值分别为 $a_{maxValPos}, b_{minValPos}$，再设 $up$ 和 $down$ 为其他行的最大值和最小值。求出最大值和最小值后就可以先给 $up$ 和 $down$ 赋初值，也就是最值所在的数对中的另一个数，接下来考虑更新 $up$ 和 $down$。

对于其他的数对 $(a_i,b_i)$，首先可以确定他们都不会超过 $a_{maxValPos}, b_{minValPos}$，因此我们要尽可能让这些数对的数靠近 $up$ 和 $down$，让 $up$ 和 $down$ 的变动尽可能小。

可以分 4 种情况讨论：

 - 如果 $a_i$ 或 $b_i$ 满足在 $[down, up]$ 之间，则可以把在中间的这个数放到 $up$ 和 $down$ 的行，显然 $up$ 和 $down$ 不变
 - 如果 $b_i < a_i < down$，此时必须更新 $down$，最优方案是用 $a_i$ 更新 $down$
 - 如果 $up < b_i < a_i$，此时必须更新 $up$，最优方案是用 $b_i$ 更新 $up$
 - 如果 $b_i < down \le up < a_i$，则无法即使计算出这个数对的影响，考虑稍后处理

按照上述方法初步更新 $up, down$ 后，再找出仍然满足 $b_i < down \le up < a_i$ 的数对，现在问题转化为给出若干区间 $[b_i, a_i]$，每个区间选择一个端点 $p_i$，使得这些端点和 $up, down$ 这两个点组成的区间 $[\min \{p_i,up,down\},\max \{p_i,up,down\}]$ 的长度最短。

考虑区间的关系，若一个区间被另一个区间完全覆盖，则这个区间对答案没有贡献，因为在被覆盖的情况下，大区间选择任意一个端点，小区间都可选择与大区间同一侧的端点，此时对答案没有影响，若选择相反方向，则可能使答案更劣。因此，我们可以去掉被包含的区间，剩下的就是两两相交的区间，且它们还满足一个很好的性质，就是左右端点都是单调递增的。

然后就是一个很显然的结论：将这些区间按照左端点排序后，一定存在一个分界点，满足分界点之前的区间都是选择右端点，分界点之后的区间都是选择左端点，证明就省略了，现在直接枚举分界点更新 $[up, down]$ 即可。

再考虑不在同一行的情况，此时设出一样的变量，但是 $up$ 是与 $a_{maxValPos}$ 在同一行的，$down$ 是与 $b_{minValPos}$ 在同一行的。为了最小化答案，就要使 $up$ 尽可能接近 $a_{maxValPos}$，$down$ 尽可能接近 $b_{minValPos}$。

所以找到最值后，先初始化 $up$ 为 $a_{minValPos}$，$down$ 为 $b_{maxValPos}$，然后再用 $a_i$ 更新 $up$，用 $b_i$ 更新 $down$。

时间复杂度为 $\mathcal O(n \log_2 n)$。

### P 之兴奋
首先考虑不改变 $t$ 的情况，此时是裸的斜率优化 DP。

设 $f[i]$ 表示考虑前 $i$ 道题的最大兴奋值，$s[i]$ 为 $t[i]$ 的前缀和，则有如下方程：

$$
f[i]=\max\left\{f[i-1],\max_{j=0}^{i-1}\left\{f[j]+\frac{(i-j)(i-j+1)}{2}-s[i]+s[j]\right\}\right\}
$$

去掉 $\max$ 并移项得到：

$$
f[j]+\frac{j^2-j}{2}+s[j]=ij+f[i]-\frac{i^2+i}{2}+s[i]
$$

$k=i$ 递增，$x=j$ 递增，维护上凸壳，使用单调栈。时间复杂度 $\mathcal O(n)$。

再考虑改变了 $t$ 的情况，假设把 $t_p$ 改为 $x$。显然可以考虑选 $p$ 这道题或者不选。

设 $g[i]$ 表示从后往前，考虑后 $i$ 道题的最大兴奋值，求解方法与 $f$ 的类似。则此时可以得出改变后不选 $p$ 这道题的答案为 $f[p-1]+g[p+1]$。

设 $h[i]$ 表示强制选择第 $i$ 道题的总的最大兴奋值，则可以得出改变后选 $p$ 这道题的答案为 $h[p]-t_p+x$。

接下来问题就是求 $h$，其难点在于如何确定包含 $p$ 的这个区间及其贡献。可以枚举其中一个端点作为分界点，另一边用某种方法处理一下。可以考虑分治，假设当前分治区间为 $[l,r]$，中点为 $mid=\frac{l+r}{2}$。现在强制规定这个区间必须越过 $mid$，而没有越过 $mid$ 的区间的贡献就当作子问题，递归处理即可。

对于左区间 $[l,mid]$，设 $p[i+1]$ 为选择 $p+1$ 为区间左端点的最大值：

$$
p[i+1]=f[i]+\max_{j=mid+1}^{r}\left\{g[j+1]+\frac{(j-i)(j-i+1)}{2}-s[j]+s[i]\right\}
$$

则对于左区间的 $h[i]$，用 $\max_{j=l}^{i} \{p[j]\}$ 更新。

对于右区间 $[mid + 1,r]$，设 $q[i]$ 为选择 $q$ 为区间右端点的最大值：

$$
q[i]=g[i+1]+\max_{j=l-1}^{mid-1}\left\{f[j]+\frac{(i-j)(i-j+1)}{2}-s[i]+s[j]\right\}
$$

则对于右区间的 $h[i]$，用 $\max_{j=i}^{r} \{q[j]\}$ 更新。

所以每个询问的答案就是 $\max\{f[p-1]+g[p+1],h[p]-t_p+x\}$。

总时间复杂度为 $\mathcal O(n \log_2 n)$。

### 校之装饰
题目很明显是要求一个二分图的类似于匹配的方案。

首先考虑求个数。有一个经典性质：任意一个二分图的最大度数若若为 $k$，则可以被 $k$ 染色，这里的 $k$ 染色就是指用 $k$ 种不同颜色把每一条边染色，且对于每个点，所连接的边的颜色不同。

发现题目可以转化为找到一个最大度数为 $k$ 的子图，满足其边数最多，于是源点向 $1\le x \le \lfloor \frac{n}{2} \rfloor$ 的 $x$ 连容量为 $k$ 的边，$\lfloor \frac{n}{2} \rfloor < y \le n$ 的 $y$ 向汇点连容量为 $k$ 的边，原图中的边则容量为 $1$。

然后考虑求方案，直接根据残量网络找出这个子图，然后有两种方法：

方法 1：按照度数从大到小，对于度数足够大的点，找一条所连接的边染一种可行的颜色，然后删去这条染色过的边，两端点度数减 $1$，重复这一过程，直到图中没有边。

方法 2：任意一个正则二分图均存在完美匹配，将这个图补全为一个 $k$ 正则二分图，找 $k$ 次完美匹配，每次给匹配边一种颜色，然后删掉这些匹配边，删掉边后的图仍然是正则二分图，所以还是存在完美匹配，最后在留下原有的边即可。